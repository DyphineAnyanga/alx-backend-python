#!/bin/bash

echo "ğŸ”„ Applying updated deployment (image version 2.0)..."
kubectl apply -f messaging_app/messaging_app/blue_deployment.yaml

echo "â³ Waiting for rollout to complete..."
kubectl rollout status deployment/messaging-blue

echo "ğŸŒ Testing app availability during rollout..."
for i in {1..10}; do
    curl --max-time 2 -s http://$(minikube ip)/
    sleep 1
done

echo "âœ… Verifying updated pods:"
kubectl get pods -l app=messaging
